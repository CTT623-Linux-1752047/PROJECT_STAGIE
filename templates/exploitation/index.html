{% extends "base/index.html" %}
{% load static %}
{% block stylesheet %}
<link rel="stylesheet" href="{% static 'vendor/select2/css/select2.min.css' %}">
<link href="{% static 'css/style.css' %}" rel="stylesheet">
{% endblock %}
{%block beforeScript%}
<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
{% endblock %}

{% block content %}
<div class="col-lg-12">
    <div class="card">
        <div class="card-body">
            <div id="accordion-five" class="accordion accordion-left-indicator" style="background-color: white">
                <div class="accordion__item">
                    <div class="accordion__header collapsed" data-toggle="collapse" data-target="#left-indicator_collapseTwo">
                        <span class="accordion__header--text">Recherche Information</span>
                        <span class="accordion__header--indicator"></span>
                    </div>
                    <div id="left-indicator_collapseTwo" class="collapse accordion__body pnlSearch" data-parent="#accordion-five">
                        <div class="accordion__body--text">
                            <h4 class="card-title">Les données d'entrée</h4>
                            <div class="row" >
                                <div class="col-lg-2">
                                    <select class="single-select-placeholder js-states" id="typeSearch">
                                        <option value=""></option>
                                        <option value="TT">Type de tâches</option>
                                        <option value="T">Techniques</option>
                                    </select>
                                </div>
                                <div class="col-lg-7">
                                    <select class="single-select-placeholder js-states" id="searchCondition" >
                                        <option value=""></option>
                                    </select>
                                </div>
                                <div class="colg-lg-3">
                                    <button type="button" id="btnSearch" class="btn btn-secondary " style="float:right ; margin-top:-2px">
                                        <i class="ti-search"></i>
                                        &nbsp;Recherche
                                    </button>
                                </div>
                            </div>     
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row card-body">
    <div class="col-lg-10">
        <div class="card">
            <div class="card-body">
                <!-- Nav tabs -->
                <div class="default-tab">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#graph">le graph données</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#table">Le tableau</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="graph" role="tabpanel">
                            <div id="viz">
                            </div>
                        </div>
                        <div class="tab-pane fade" id="table">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="table-responsive" >
                                            <table class="table table-bordered table-striped verticle-middle table-responsive-sm" >
                                                <tbody id="tblData"> 
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% comment %} <div class="card-footer">
                Card footer
            </div> {% endcomment %}
        </div>
    </div>
    <div class="col-lg-2">
        <div class="card">
            <div class="card-body">
                <div id="accordion-seven" class="accordion accordion-header-bg accordion-bordered">
                    <div class="accordion__item">
                        <div class="accordion__header collapsed accordion__header--info" data-toggle="collapse" data-target="#header-bg_collapseTwo">
                            <span class="accordion__header--icon"></span>
                            <span class="accordion__header--text">Notation</span>
                            <span class="accordion__header--indicator"></span>
                        </div>
                        <div id="header-bg_collapseTwo" class="collapse accordion__body" data-parent="#accordion-seven" style="background-color:white">
                            <div class="accordion__body--text">
                                <div class="row">
                                    <div class="col-lg-1">
                                        <div id="imgTT"></div>
                                    </div>
                                    <span class="col-lg-10" id="txtTT">
                                        Type de tâche 
                                    </span>  
                                </div>
                                <div class="row">
                                    <div class="col-lg-1">
                                        <div id="imgLII"></div>
                                    </div>
                                    <span class="col-lg-10" id="txtLII">
                                        Local Instance Info 
                                    </span>
                                </div>
                                <div class="row">
                                    <div class="col-lg-1">
                                        <div id="imgST"></div>
                                    </div>
                                    <span class="col-lg-10" id="txtST">
                                        Étudiant
                                    </span>
                                </div>
                                <div class="row">
                                    <div class="col-lg-1">
                                        <div id="imgL"></div>
                                    </div>
                                    <span class="col-lg-10" id="txtL">
                                        Level
                                    </span>
                                </div>
                                <div class="row">
                                    <div class="col-lg-1">
                                        <div id="imgGR"></div>
                                    </div>
                                    <span class="col-lg-10" id="txtGR">
                                        Groupe ou Classe
                                    </span>
                                </div>
                                <div class="row">
                                    <div class="col-lg-1">
                                        <div id="imgVV"></div>
                                    </div>
                                    <span class="col-lg-10" id="txtVV">
                                        Valeur de variable
                                    </span>
                                </div>
                                <div class="row"></div>
        
                                <div class="row">
                                    <div class="col-lg-1">
                                        <div id="imgT"></div>
                                    </div>
                                    <span class="col-lg-10" id="txtT">
                                        Technique
                                    </span>
                                </row>
                            </div>                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block afterScript %}
<script src="{% static 'vendor/select2/js/select2.full.min.js' %}"></script>
<script src="{% static 'js/plugins-init/select2-init.js' %}"></script>
<script type="text/javascript">
    var viz;
    function draw(cypher="") {
        var config = {
            container_id: "viz",
            server_url: "bolt://localhost:7687",
            server_user: "neo4j",
            server_password: "123",
            labels: {
                "TaskType" : {
                    "caption": "taskTypeName",
                    "title_properties": [
                        "taskTypeCd",
                        "taskTypeName"
                    ],
                    "community": "community",
                    "color" : "#ff8fb0",
                    "font": {
                        "size":18,
                        "color":"#000000"
                    },
                },
                "Technique" : {
                    "caption": "techniqueCd",
                    "title_properties": [
                        "techniqueCd",
                        "techniqueName"
                    ],
                    
                    "font": {
                        "size":18,
                        "color":"#000000",
                        "background-color": "red",
                    },
                },
                "VariableValue" : {
                    "caption": "variableValue",
                    "title_properties": [
                        "variableValueCd",
                        "variableValue",
                        "variableType"
                    ],
                    "font": {
                        "size":18,
                        "color":"#000000"
                    },
                },
                "Level" : {
                    "caption": "levelName",
                    "title_properties": [
                        "levelCd",
                        "levelName",
                    ],
                    "font": {
                        "size":18,
                        "color":"#000000"
                    },
                },
                "Group" : {
                    "caption": "groupName",
                    "title_properties": [
                        "groupCd",
                        "groupName",
                    ],
                    "font": {
                        "size":18,
                        "color":"#000000"
                    },
                },
                "Student" : {
                    "caption": "fullNameStudent",
                    "title_properties": [
                        "studentCd",
                        "fullNameStudent",
                    ],
                    "font": {
                        "size":18,
                        "color":"#000000"
                    },
                },
                "LocalInsInfo" : {
                    "caption": "",
                    "title_properties": [
                        "localInsInfoCd",
                    ],
                    "color" : "#E0E0E0",
                    "font": {
                        "size":18,
                        "color":"#000000"
                    },
                },
                

            },
            relationships: {
                "hasVariableValue": {
                    "thickness": "weight",
                    "caption": false,
                    "color":"#9a6cf0"
                    
                },
                "hasSubTaskType": {
                    "thickness": "weight",
                    "caption": false,
                },
                "hasPragmaticScope": {
                    "thickness": "weight",
                    "caption": false
                },
                "hasGlobalConcurrency" : {
                    "thickness": "weight",
                    "caption": false
                },
                "hasPartialConcurrency" : {
                    "thickness": "weight",
                    "caption": false
                },
                "hasConcurrencyByExtension" : {
                    "thickness": "weight",
                    "caption": false,
                },
                "relatedToTech" : {
                    "thickness": "weight",
                    "caption": false,
                },
                "relatedToStudent" : {
                    "thickness": "weight",
                    "caption": false,
                },
                "relatedToLevel" : {
                    "thickness": "weight",
                    "caption": false,
                },
                "arrangedIn" : {
                    "thickness": "weight",
                    "caption": false,
                },


            },
            arrows:true,
            initial_cypher: cypher
        };
        
        viz = new NeoVis.default(config);
        viz.render();
    }

    function ReformatFor10Char(str){
        len = str.length
        switch(len) {
            case 1:
                return "     " + str + "    "
                break;
            case 2:
                return "    " + str + "    "
                break;
            case 3:
                return "    " + str + "   "
              break;
            case 4:
                return "   " + str + "   "
                break;
            case 5:
                return "   " + str + "  "
              break;
            case 6:
                return "  " + str + "  "
                break;
            case 7:
                return "  " + str + " "
                break;
            case 8:
                return " " + str + " "
                break;
            case 9:
                return " " + str
                break;
            case 10:
                return str
                break;
            default:
                return str
          }
    }

    function drawGraphTaskType(data){
        var idInclude = [];
        var listData = [];
        obj = {
            id : data["TaskTypeID"],
            label : ReformatFor10Char(data["TaskTypeCd"]),
            shape : "circle",
            font: {
                "size":18,
            },
            color : "#ccff00", 
            title : data["TaskTypeCd"] + " - " + data["TaskTypeName"]
        }
        listData.push(obj)
        idInclude.push(data["TaskTypeID"])

        //array nodes for variable value 
        for(let i = 0; i < data["VariableValue"].length; i++){
            if (!idInclude.includes(data["VariableValue"][i][3])){
                obj = {
                    id : data["VariableValue"][i][3],
                    label : ReformatFor10Char(data["VariableValue"][i][2]),
                    shape : "circle",
                    value : 40,
                    font: {
                        "size":18,
                    },
                    color : "#59bfff", 
                    title : data["VariableValue"][i][2] + " - " + data["VariableValue"][i][0] + " - "  + data["VariableValue"][i][1],
                }
                listData.push(obj)
                idInclude.push(data["VariableValue"][i][3])
            }
        }

        //array nodes for technique this task type 
        for(let i = 0; i < data["Technique"].length; i++){
            if (!idInclude.includes(data["Technique"][i][2])){
                obj = {
                    id : data["Technique"][i][2],
                    label : ReformatFor10Char(data["Technique"][i][0]),
                    shape : "circle",
                    color : "#bd3342", 
                    font: {
                        "size":18,
                        "color" : "	#fffbf8",
                    },
                    title : {
                        "code de technique" : data["Technique"][i][0],
                        "nom de technique" : data["Technique"][i][1]
                    }
                }
                listData.push(obj)
                idInclude.push(data["Technique"][i][2])
            }
        }

        //array nodes for parent task type with technique of us 
        for(let i = 0; i < data["relationParent"].length; i++){       
            if (data["relationParent"][i].length > 5){
                if (idInclude.includes(data["relationParent"][i][4]) == false){
                    //add node of parent task type 
                    obj = {
                        id : data["relationParent"][i][4],
                        label : ReformatFor10Char(data["relationParent"][i][0]),
                        shape : "circle",
                        color : "#ccff00", 
                        font: {
                            "size":18,
                        },
                        title : data["relationParent"][i][0] + " - " + data["relationParent"][i][1]
                    }
    
                    listData.push(obj)

                    //add node of technique of parent task type 
                    obj = {
                        id : data["relationParent"][i][5],
                        label : ReformatFor10Char(data["relationParent"][i][2]),
                        shape : "circle",
                        color : "#bd3342", 
                        font: {
                            "size":18,
                            "color" : "	#fffbf8",
                        },
                        title : data["relationParent"][i][2] + " - " + data["relationParent"][i][3]
                    }
    
                    listData.push(obj)
                } else {
                    //add node of technique of parent task type 
                    obj = {
                        id : data["relationParent"][i][5],
                        label : ReformatFor10Char(data["relationParent"][i][2]),
                        shape : "circle",
                        color : "#bd3342", 
                        font: {
                            "size":18,
                            "color" : "	#fffbf8",
                        },
                        title : data["relationParent"][i][2] + " - " + data["relationParent"][i][3]
                    }
    
                    listData.push(obj)
                }
            }
            else {
                //add node of parent task type 
                obj = {
                    id : data["relationParent"][i][4],
                    label : ReformatFor10Char(data["relationParent"][i][0]),
                    shape : "circle",
                    color : "#ccff00", 
                    font: {
                        "size":18,
                    },
                    title : data["relationParent"][i][0] + " - " + data["relationParent"][i][1]
                }

                listData.push(obj)
            }
            idInclude.push(data["relationParent"][i][4])
        }

        //array nodes for child task type with technique of us 
        for(let i = 0; i < data["relationChild"].length; i++){ 
            if (data["relationChild"][i].length > 5){
                if (!idInclude.includes(data["relationChild"][i][4])){
                    // add node of child task type 
                    obj = {
                        id : data["relationChild"][i][4],
                        label : ReformatFor10Char(data["relationChild"][i][0]),
                        shape : "circle",
                        font: {
                            "size":18,
                        },
                        color : "#ccff00", 
                        title : data["relationChild"][i][0] + " - " + data["relationChild"][i][1]
                    }

                    listData.push(obj)

                    // add node of technique of child task type 
                    obj = {
                        id : data["relationChild"][i][5],
                        label : ReformatFor10Char(data["relationChild"][i][2]),
                        shape : "circle",
                        font: {
                            "size":18,
                            "color" : "	#fffbf8",
                        },
                        color : "#bd3342", 
                        title : data["relationChild"][i][2] + " - " + data["relationChild"][i][3]
                    }

                    listData.push(obj)
                }
                else {
                    // add node of technique of child task type 
                    obj = {
                        id : data["relationChild"][i][5],
                        label : ReformatFor10Char(data["relationChild"][i][2]),
                        shape : "circle",
                        color : "#bd3342", 
                        font: {
                            "size":18,
                            "color" : "	#fffbf8",
                        },
                        title : data["relationChild"][i][2] + " - " + data["relationChild"][i][3]
                    }
    
                    listData.push(obj)
                }
            } else {
                // add node of parent task type 
                obj = {
                    id : data["relationChild"][i][4],
                    label : ReformatFor10Char(data["relationChild"][i][0]),
                    shape : "circle",
                    color : "#ccff00", 
                    font: {
                        "size":18,
                    },
                    title : data["relationChild"][i][0] + " - " + data["relationChild"][i][1]
                }

                listData.push(obj)
            }
            idInclude.push(data["relationChild"][i][4])
        }
        
        var listRelation = []
        idInclude = []
        //array relationship for variable value 
        for(let i = 0; i < data["VariableValue"].length; i++){          
            obj = {
                from : data["TaskTypeID"],
                to : data["VariableValue"][i][3],
                color : "#59bfff", 
                title : "has Variable Value"
            }
            listRelation.push(obj)
            idInclude.push(data["VariableValue"][i][3])
        }

        //array relationship for technique this task type 
        for(let i = 0; i < data["Technique"].length; i++){
            obj = {
                from : data["Technique"][i][2],
                to : data["TaskTypeID"],
                color : "#bd3342", 
                title : "has Pragmatic Scope"
            }
            listRelation.push(obj)
            idInclude.push(data["Technique"][i][2])
        }

        //array relationship for parent task type with technique of us 
        for(let i = 0; i < data["relationParent"].length; i++){  
            if (!idInclude.includes(data["relationParent"][i][4])){
                obj = {
                    from : data["TaskTypeID"],
                    to : data["relationParent"][i][4],
                    color : "#ccff00", 
                    title : "has sub Task Type"
                }
    
                listRelation.push(obj)  
                idInclude.push(data["relationParent"][i][4])
            }
            if (data["relationParent"][i].length > 5){
                //add relationship of technique of parent task type 
                obj = {
                    from : data["relationParent"][i][5],
                    to : data["relationParent"][i][4],
                    color : "#bd3342", 
                    title : "has Pragmatic Scope"
                }

                listRelation.push(obj)
            } 
        }

        //array relationship for child task type with technique of us 
        for(let i = 0; i < data["relationChild"].length; i++){  
            if(!idInclude.includes(data["relationChild"][i][4]))  {
                obj = {
                    from : data["relationChild"][i][4],
                    to : data["TaskTypeID"],
                    color : "#ccff00", 
                    title : "has sub Task Type"
                }
                idInclude.push(data["relationChild"][i][4])
                listRelation.push(obj)  
            }
            if (data["relationChild"][i].length > 5){
                //add relationship of technique of parent task type 
                obj = {
                    from : data["relationChild"][i][5], 
                    to : data["relationChild"][i][4],
                    color : "#bd3342", 
                    title : "has Pragmatic Scope"
                }

                listRelation.push(obj)
            }
        }


        var nodes = new vis.DataSet(listData)
        var edges = new vis.DataSet(listRelation)

        // create a network
        var container = document.getElementById('viz');

        // provide the data in the vis format
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {
       
            edges:{
                arrows: {
                    to: {enabled: true , scaleFactor: 1  },
                }
            }
        };

        // initialize your network!
        var network = new vis.Network(container, data, options);

    }

    function drawTableTaskType(data){
        tblData = $("#tblData")
        tblData.empty()
        
        // add area for task type
        if(data["Technique"].length != 0){
            trHeadTech = $("<tr/>")

            col1 = $("<th/>")
            col1.attr("rowspan", data["Technique"].length )
            col1.attr("witdh", "16%")
            col1.text("Les techniques associées")
            trHeadTech.append(col1)

            col2 = $("<th/>")
            col2.attr("width","84%")
            col2.text(data["Technique"][0][0] + " - " + data["Technique"][0][1])
            trHeadTech.append(col2)

            tblData.append(trHeadTech)
            for(let i = 1; i < data["Technique"].length; i++){
                trBody = $("<tr/>")

                col1 = $("<th/>")
                col1.attr("width","84%")
                col1.text(data["Technique"][i][0] + " - " + data["Technique"][i][1])
                trBody.append(col1)

                tblData.append(trBody)
            }
        }
        if(data["VariableValue"].length != 0){
            trHeaderVariableValue = $("<tr/>")

            col1 = $("<th/>")
            col1.attr("rowspan", data["VariableValue"].length)
            col1.text("Les valeurs de variables")
            trHeaderVariableValue.append(col1)

            col2 = $("<th/>")
            col2.text(data["VariableValue"][0][0] + " - " + data["VariableValue"][0][2] + " - " + data["VariableValue"][0][1])
            trHeaderVariableValue.append(col2)

            tblData.append(trHeaderVariableValue)

            for(let i = 1; i < data["VariableValue"].length; i++){
                trBody = $("<tr/>")

                col1 = $("<th/>")
                col1.text(data["VariableValue"][i][0] + " - " + data["VariableValue"][i][2] + " - " + data["VariableValue"][i][1])
                trBody.append(col1)

                tblData.append(trBody)
            }
        }
        if(data["relationParent"].length != 0) {
            trHeader = $("<tr/>")

            col1 = $("<th/>")
            col1.attr("witdh","16%")
            col1.attr("rowspan", data["relationParent"].length)
            col1.text("Le type de tâche parent, et les techniques attachées à ce type de tâche parent")
            trHeader.append(col1)

            txt = data["relationParent"][0][0] + " - " + data["relationParent"][0][1]
            txt = txt + (data["relationParent"][0][2] == "" ? "": " ※ " + data["relationParent"][0][2])
            txt = txt + (data["relationParent"][0][3] == "" ? "" : " - "  + data["relationParent"][0][3])
            col2 = $("<th/>")
            col2.attr("width","84%")
            col2.text(txt)
            trHeader.append(col2)

            tblData.append(trHeader)
            for(let i = 1; i < data["relationParent"].length; i++){
                trBody = $("<tr/>")

                txt = data["relationParent"][i][0] + " - " + data["relationParent"][i][1]
                txt = txt + (data["relationParent"][i][2] == "" ? "" : " ※ " + data["relationParent"][i][2])
                txt = txt + (data["relationParent"][i][3] == "" ? "" : " - "  + data["relationParent"][i][3])

                col1 = $("<th/>")
                col1.text(txt)
                trBody.append(col1)

                tblData.append(trBody)
            }
        }
        if(data["relationChild"].length != 0) {
            trHeaderChild = $("<tr/>")

            col1 = $("<th/>")
            col1.attr("witdh","16%")
            col1.attr("rowspan", data["relationChild"].length)
            col1.text("Les sous types de tâches, et les techniques attachées à chaque sous type de tâches")
            trHeaderChild.append(col1)

            txt = data["relationChild"][0][0] + " - " + data["relationChild"][0][1]
            txt = txt + (data["relationChild"][0][2] == "" ? "": " ※ " + data["relationChild"][0][2])
            txt = txt + (data["relationChild"][0][3] == "" ? "" : " - "  + data["relationChild"][0][3])

            col2 = $("<th/>")
            col2.attr("width","84%")
            col2.text(txt)
            trHeaderChild.append(col2)

            tblData.append(trHeaderChild)

            for(let i = 1; i < data["relationChild"].length; i++){
                trBody = $("<tr/>")

                txt = data["relationChild"][i][0] + " - " + data["relationChild"][i][1]
                txt = txt + (data["relationChild"][i][2] == "" ? "" : " ※ " + data["relationChild"][i][2])
                txt = txt + (data["relationChild"][i][3] == "" ? "" : " - "  + data["relationChild"][i][3])

                col1 = $("<th/>")
                col1.text(txt)
                trBody.append(col1)

                tblData.append(trBody)
            }
        }  
    }

    function setNotationT1(){
        // set notation for case only task type 
        $("#imgST").hide()
        $("#txtST").hide()

        $("#imgL").hide()
        $("#txtL").hide()

        $("#imgLII").hide()
        $("#txtLII").hide()

        $("#imgGR").hide()
        $("#txtGR").hide()

        $("#imgVV").show()
        $("#imgVV").attr("style","height: 12px; width: 12px; background-color: #98c4fc; margin-top:4px; border-radius: 50%")
        $("#txtVV").show()

        $("#imgTT").show()
        $("#imgTT").attr("style","height: 12px; width: 12px; background-color: 	#ccff00; margin-top:4px; border-radius: 50%")
        $("#txtTT").show()

        $("#imgT").show()
        $("#imgT").attr("style","height: 12px; width: 12px; background-color: #bd3342; margin-top:4px; border-radius: 50%")
        $("#txtT").show()
    }
    
    function setNotationT2(){
        // set notation for case only technique
        $("#imgST").hide()
        $("#txtST").hide()

        $("#imgL").hide()
        $("#txtL").hide()

        $("#imgLII").hide()
        $("#txtLII").hide()

        $("#imgGR").hide()
        $("#txtGR").hide()

        $("#imgVV").hide()
        $("#txtVV").hide()

        $("#imgTT").show()
        $("#imgTT").attr("style","height: 12px; width: 12px; background-color: #b4cffb; margin-top:4px; border-radius: 50%")
        $("#txtTT").show()

        $("#imgT").show()
        $("#imgT").attr("style","height: 12px; width: 12px; background-color: #f2a2c0; margin-top:4px; border-radius: 50%")
        $("#txtT").show()
    }

    function drawGraphTechnique(data){
        var idInclude = [];
        var listData = [];
        obj = {
            id : data["techniqueID"],
            label : ReformatFor10Char(data["techniqueCd"]),
            shape : "circle",
            font: {
                "size":18,
            },
            color : "#f2a2c0", 
            title : data["techniqueCd"] + " - " + data["techniqueName"]
        }
        listData.push(obj)
        idInclude.push(data["techniqueID"])

        //array nodes for task type
        for(let i = 0; i < data["TypeTache"].length; i++){
            obj = {
                id : data["TypeTache"][i][3],
                label : ReformatFor10Char(data["TypeTache"][i][0]),
                shape : "circle",
                font: {
                    "size":18,
                },
                color : "#b4cffb", 
                title : data["TypeTache"][i][0] + " - " + data["TypeTache"][i][1]
            }
            listData.push(obj)
            idInclude.push( data["TypeTache"][i][3])
        }
        //array nodes for technique global
        for(let i = 0; i < data["GlobalTech"].length; i++){
            if(!idInclude.includes(data["GlobalTech"][i][2])){
                obj = {
                    id : data["GlobalTech"][i][2],
                    label : ReformatFor10Char(data["GlobalTech"][i][0]),
                    shape : "circle",
                    font: {
                        "size":18,
                    },
                    color : "#f2a2c0", 
                    title : data["GlobalTech"][i][0] + " - " + data["GlobalTech"][i][1]
                }
                listData.push(obj)
                idInclude.push( data["GlobalTech"][i][2])
            }
        }
        //array nodes for technique extend
        for(let i = 0; i < data["ExpTech"].length; i++){
            if(!idInclude.includes(data["ExpTech"][i][2])){
                obj = {
                    id : data["ExpTech"][i][2],
                    label : ReformatFor10Char(data["ExpTech"][i][0]),
                    shape : "circle",
                    font: {
                        "size":18,
                    },
                    color : "#f2a2c0", 
                    title : data["ExpTech"][i][0] + " - " + data["ExpTech"][i][1]
                }
                listData.push(obj)
                idInclude.push( data["ExpTech"][i][2])
            }
        }
        //array nodes for technique partiel
        for(let i = 0; i < data["PartielTech"].length; i++){
            if(!idInclude.includes(data["PartielTech"][i][2])){
                obj = {
                    id : data["PartielTech"][i][2],
                    label : ReformatFor10Char(data["PartielTech"][i][0]),
                    shape : "circle",
                    font: {
                        "size":18,
                    },
                    color : "#f2a2c0", 
                    title : data["PartielTech"][i][0] + " - " + data["PartielTech"][i][1]
                }
                listData.push(obj)
                idInclude.push( data["PartielTech"][i][2])
            }
        }
      
        var listRelation = []
        idInclude = []
        //array relationship for task type 
        for(let i = 0; i < data["TypeTache"].length; i++){          
            obj = {
                from : data["TypeTache"][i][2],
                to : data["TypeTache"][i][3],
                color : "#59bfff", 
                title : "has Pragmatic Scope"
            }
            listRelation.push(obj)
            idInclude.push(data["TypeTache"][i][3])
        }

        //array relationship for technique global
        for(let i = 0; i < data["GlobalTech"].length; i++){
            obj = {
                from : data["techniqueID"],
                to : data["GlobalTech"][i][2],
                color : "#bd3342", 
                title : "has Global Concurency Technique"
            }
            listRelation.push(obj)
            idInclude.push(data["GlobalTech"][i][2])
        }

        //array relationship for technique extend
        for(let i = 0; i < data["ExpTech"].length; i++){
            obj = {
                from : data["ExpTech"][i][2],
                to : data["techniqueID"],
                color : "#bd3342", 
                title : "has Extend Concurency Technique"
            }
            listRelation.push(obj)
            idInclude.push(data["ExpTech"][i][2])
        }

        //array relationship for technique partiel 
        for(let i = 0; i < data["PartielTech"].length; i++){
            obj = {
                from : data["techniqueID"],
                to : data["PartielTech"][i][2],
                color : "#bd3342", 
                title : "has Partial Concurency Technique"
            }
            listRelation.push(obj)
            idInclude.push(data["PartielTech"][i][2])
        }

        var nodes = new vis.DataSet(listData)
        var edges = new vis.DataSet(listRelation)

        // create a network
        var container = document.getElementById('viz');

        // provide the data in the vis format
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {
       
            edges:{
                arrows: {
                    to: {enabled: true , scaleFactor: 1  },
                }
            }
        };

        // initialize your network!
        var network = new vis.Network(container, data, options);

    }

    function drawTableTechnique(data){
        tblData = $("#tblData")
        tblData.empty()
        
        // add area for technique
        if(data["TypeTache"].length != 0){
            trHeadTech = $("<tr/>")

            col1 = $("<th/>")
            col1.attr("rowspan", data["TypeTache"].length )
            col1.attr("witdh", "20%")
            col1.text("Le type de tâche attaché")
            trHeadTech.append(col1)

            col2 = $("<th/>")
            col2.attr("width","80%")
            col2.text(data["TypeTache"][0][0] + " - " + data["TypeTache"][0][1])
            trHeadTech.append(col2)

            tblData.append(trHeadTech)
            for(let i = 1; i < data["TypeTache"].length; i++){
                trBody = $("<tr/>")

                col1 = $("<th/>")
                col1.attr("width","80%")
                col1.text(data["TypeTache"][i][0] + " - " + data["TypeTache"][i][1])
                trBody.append(col1)

                tblData.append(trBody)
            }
        }

        if(data["GlobalTech"].length != 0){
            trHeadTech = $("<tr/>")

            col1 = $("<th/>")
            col1.attr("rowspan", data["GlobalTech"].length )
            col1.attr("witdh", "20%")
            col1.text("Les techniques en concurrence globale")
            trHeadTech.append(col1)

            col2 = $("<th/>")
            col2.attr("width","80%")
            col2.text(data["GlobalTech"][0][0] + " - " + data["GlobalTech"][0][1])
            trHeadTech.append(col2)

            tblData.append(trHeadTech)
            for(let i = 1; i < data["GlobalTech"].length; i++){
                trBody = $("<tr/>")

                col1 = $("<th/>")
                col1.attr("width","80%")
                col1.text(data["GlobalTech"][i][0] + " - " + data["GlobalTech"][i][1])
                trBody.append(col1)

                tblData.append(trBody)
            }
        }

        if(data["ExpTech"].length != 0){
            trHeadTech = $("<tr/>")

            col1 = $("<th/>")
            col1.attr("rowspan", data["ExpTech"].length )
            col1.attr("witdh", "20%")
            col1.text("Les techniques en concurrence par extension")
            trHeadTech.append(col1)

            col2 = $("<th/>")
            col2.attr("width","80%")
            col2.text(data["ExpTech"][0][0] + " - " + data["ExpTech"][0][1])
            trHeadTech.append(col2)

            tblData.append(trHeadTech)
            for(let i = 1; i < data["ExpTech"].length; i++){
                trBody = $("<tr/>")

                col1 = $("<th/>")
                col1.attr("width","80%")
                col1.text(data["ExpTech"][i][0] + " - " + data["ExpTech"][i][1])
                trBody.append(col1)

                tblData.append(trBody)
            }
        }

        if(data["PartielTech"].length != 0){
            trHeadTech = $("<tr/>")

            col1 = $("<th/>")
            col1.attr("rowspan", data["PartielTech"].length )
            col1.attr("witdh", "20%")
            col1.text("Les techniques en concurrence partiel")
            trHeadTech.append(col1)

            col2 = $("<th/>")
            col2.attr("width","80%")
            col2.text(data["PartielTech"][0][0] + " - " + data["PartielTech"][0][1])
            trHeadTech.append(col2)

            tblData.append(trHeadTech)
            for(let i = 1; i < data["PartielTech"].length; i++){
                trBody = $("<tr/>")

                col1 = $("<th/>")
                col1.attr("width","80%")
                col1.text(data["PartielTech"][i][0] + " - " + data["PartielTech"][i][1])
                trBody.append(col1)

                tblData.append(trBody)
            }
        }

    }

    $(document).ready(function() {
        $("#typeSearch").change(function(){
            typeSearch = $("#typeSearch").val()
            
            $("#typeSearch").val(typeSearch)

            // call ajax fill data to searchCondition1
            url = window.location.href + "/getDataResearch"
            $("#searchCondition").attr("disabled",true)
            $.ajax({
                url : url,
                type : 'GET',
                data : {
                    "typeSearch" : typeSearch
                },
                success : function(response) {                      
                    var selectBtn = $("#searchCondition").empty()
                    for(let i = 0; i < response["data"].length; i++){
                        var o = new Option(response["data"][i]["code"] + " - " + response["data"][i]["name"], response["data"][i]["code"]); 
                        $("#searchCondition").append(o);
                    }     
                    $("#searchCondition").attr("disabled",false)
                    
                },
                error : function(request,error)
                {
                    alert("Request: "+JSON.stringify(request));
                }
            });
        })

        $("#btnSearch").click(function(){
            searchCondition = $("#searchCondition").val()
        
            typeSearch = $("#typeSearch").val()

            var cypher = ""
            // draw visualize graph 
           
            // draw(cypher)
           
            // call ajax fill data to table
            url = window.location.href + "/getData"
            $.ajax({
                url : url,
                type : 'GET',
                data : {
                    "typeSearch" : typeSearch,
                    "searchCondition" : searchCondition,
                },
                success : function(response) {                      
                    console.log(response["data"])  
                    if(response["data"]["Type"] == "TT"){
                        setNotationT1()
                        drawTableTaskType(response["data"])
                        drawGraphTaskType(response["data"])
                    }
                    else {
                        setNotationT2()
                        drawTableTechnique(response["data"])
                        drawGraphTechnique(response["data"])
                    }
                    
                },
                error : function(request,error)
                {
                    alert("Request: "+JSON.stringify(request));
                }
            });
       })

    });
</script>
{% endblock %}

